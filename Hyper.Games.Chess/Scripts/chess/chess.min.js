"use strict";
/*! Copyright (c) 2014, Jeff Hlywa (jhlywa@gmail.com)
 *  Released under the BSD license
 *  https://github.com/jhlywa/chess.js/blob/master/LICENSE
 */
var Chess=function(n){function ei(){t=new Array(128);e={w:c,b:c};f=h;u={w:0,b:0};l=c;a=0;tt=1;k=[];o={};ht(it())}function oi(){st(vt)}function st(n){var t=n.split(/\s+/),p=t[0],o=0,b=ri+"12345678/",y,e,w;if(!si(n).valid)return!1;for(ei(),y=0;y<p.length;y++)e=p.charAt(y),e==="/"?o+=8:fr(e)?o+=parseInt(e,10):(w=e<"a"?h:v,ci({type:e.toLowerCase(),color:w},s(o)),o++);return f=t[1],t[2].indexOf("K")>-1&&(u.w|=i.KSIDE_CASTLE),t[2].indexOf("Q")>-1&&(u.w|=i.QSIDE_CASTLE),t[2].indexOf("k")>-1&&(u.b|=i.KSIDE_CASTLE),t[2].indexOf("q")>-1&&(u.b|=i.QSIDE_CASTLE),l=t[3]==="-"?c:r[t[3]],a=parseInt(t[4],10),tt=parseInt(t[5],10),ht(it()),!0}function si(n){var t={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large]."},i=n.split(/\s+/),r,u,e,o,f;if(i.length!==6)return{valid:!1,error_number:1,error:t[1]};if(isNaN(i[5])||parseInt(i[5],10)<=0)return{valid:!1,error_number:2,error:t[2]};if(isNaN(i[4])||parseInt(i[4],10)<0)return{valid:!1,error_number:3,error:t[3]};if(!/^(-|[abcdefgh][36])$/.test(i[3]))return{valid:!1,error_number:4,error:t[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(i[2]))return{valid:!1,error_number:5,error:t[5]};if(!/^(w|b)$/.test(i[1]))return{valid:!1,error_number:6,error:t[6]};if(r=i[0].split("/"),r.length!==8)return{valid:!1,error_number:7,error:t[7]};for(u=0;u<r.length;u++){for(e=0,o=!1,f=0;f<r[u].length;f++)if(isNaN(r[u][f])){if(!/^[prnbqkPRNBQK]$/.test(r[u][f]))return{valid:!1,error_number:9,error:t[9]};e+=1;o=!1}else{if(o)return{valid:!1,error_number:8,error:t[8]};e+=parseInt(r[u][f],10);o=!0}if(e!==8)return{valid:!1,error_number:10,error:t[10]}}return{valid:!0,error_number:0,error:t[0]}}function it(){for(var w,p,e,b,o=0,y="",n=r.a8;n<=r.h1;n++)t[n]==null?o++:(o>0&&(y+=o,o=0),w=t[n].color,p=t[n].type,y+=w===h?p.toUpperCase():p.toLowerCase()),n+1&136&&(o>0&&(y+=o),n!==r.h1&&(y+="/"),o=0,n+=8);return e="",u[h]&i.KSIDE_CASTLE&&(e+="K"),u[h]&i.QSIDE_CASTLE&&(e+="Q"),u[v]&i.KSIDE_CASTLE&&(e+="k"),u[v]&i.QSIDE_CASTLE&&(e+="q"),e=e||"-",b=l===c?"-":s(l),[y,f,e,b,a,tt].join(" ")}function pt(n){for(var t=0;t<n.length;t+=2)typeof n[t]=="string"&&typeof n[t+1]=="string"&&(o[n[t]]=n[t+1]);return o}function ht(n){k.length>0||(n!==vt?(o.SetUp="1",o.FEN=n):(delete o.SetUp,delete o.FEN))}function hi(n){var i=t[r[n]];return i?{type:i.type,color:i.color}:null}function ci(n,i){if(!("type"in n&&"color"in n)||ri.indexOf(n.type.toLowerCase())===-1||!(i in r))return!1;var u=r[i];return n.type==ft&&!(e[n.color]==c||e[n.color]==u)?!1:(t[u]={type:n.type,color:n.color},n.type===ft&&(e[n.color]=u),ht(it()),!0)}function tr(n){var i=hi(n);return t[r[n]]=null,i&&i.type===ft&&(e[i.color]=c),ht(it()),i}function li(n,t,r,u,e){var o={color:f,from:t,to:r,flags:u,piece:n[t].type};return e&&(o.flags|=i.PROMOTION,o.promotion=e),n[r]?o.captured=n[r].type:u&i.EP_CAPTURE&&(o.captured=y),o}function d(n){function v(n,t,i,r,u){var e,f,o;if(n[i].type===y&&(b(r)===nr||b(r)===ki))for(e=[ii,ti,ut,at],f=0,o=e.length;f<o;f++)t.push(li(n,i,r,u,e[f]));else t.push(li(n,i,r,u))}var c=[],h=f,d=ot(h),ct={b:gi,w:di},et=r.a8,rt=r.h1,st=!1,lt=typeof n!="undefined"&&"legal"in n?n.legal:!0,w,k,ht,s,a,tt,ft,o,it;if(typeof n!="undefined"&&"square"in n)if(n.square in r)et=rt=r[n.square],st=!0;else return[];for(o=et;o<=rt;o++){if(o&136){o+=7;continue}if(w=t[o],w!=null&&w.color===h)if(w.type===y)for(s=o+yt[h][0],t[s]==null&&(v(t,c,o,s,i.NORMAL),s=o+yt[h][1],ct[h]===b(o)&&t[s]==null&&v(t,c,o,s,i.BIG_PAWN)),k=2;k<4;k++)(s=o+yt[h][k],s&136)||(t[s]!=null&&t[s].color===d?v(t,c,o,s,i.CAPTURE):s===l&&v(t,c,o,l,i.EP_CAPTURE));else for(k=0,it=ui[w.type].length;k<it;k++)for(ht=ui[w.type][k],s=o;;){if(s+=ht,s&136)break;if(t[s]==null)v(t,c,o,s,i.NORMAL);else{if(t[s].color===h)break;v(t,c,o,s,i.CAPTURE);break}if(w.type==="n"||w.type==="k")break}}if(st&&rt!==e[h]||(u[h]&i.KSIDE_CASTLE&&(a=e[h],tt=a+2,t[a+1]!=null||t[tt]!=null||g(d,e[h])||g(d,a+1)||g(d,tt)||v(t,c,e[h],tt,i.KSIDE_CASTLE)),u[h]&i.QSIDE_CASTLE&&(a=e[h],tt=a-2,t[a-1]!=null||t[a-2]!=null||t[a-3]!=null||g(d,e[h])||g(d,a-1)||g(d,tt)||v(t,c,e[h],tt,i.QSIDE_CASTLE))),!lt)return c;for(ft=[],o=0,it=c.length;o<it;o++)p(c[o]),wt(h)||ft.push(c[o]),nt();return ft}function rt(n){var t="",r;return n.flags&i.KSIDE_CASTLE?t="O-O":n.flags&i.QSIDE_CASTLE?t="O-O-O":(r=rr(n),n.piece!==y&&(t+=n.piece.toUpperCase()+r),n.flags&(i.CAPTURE|i.EP_CAPTURE)&&(n.piece===y&&(t+=s(n.from)[0]),t+="x"),t+=s(n.to),n.flags&i.PROMOTION&&(t+="="+n.promotion.toUpperCase())),p(n),ct()&&(t+=bt()?"#":"+"),nt(),t}function g(n,i){for(var u=r.a8;u<=r.h1;u++){if(u&136){u+=7;continue}if(t[u]!=null&&t[u].color===n){var f=t[u],o=u-i,s=o+119;if(pi[s]&1<<bi[f.type]){if(f.type===y){if(o>0){if(f.color===h)return!0}else if(f.color===v)return!0;continue}if(f.type==="n"||f.type==="k")return!0;for(var c=wi[s],e=u+c,l=!1;e!==i;){if(t[e]!=null){l=!0;break}e+=c}if(!l)return!0}}}return!1}function wt(n){return g(ot(n),e[n])}function ct(){return wt(f)}function bt(){return ct()&&d().length===0}function kt(){return!ct()&&d().length===0}function dt(){for(var u,e,h,i={},o=[],f=0,s=0,n=r.a8;n<=r.h1;n++){if(s=(s+1)%2,n&136){n+=7;continue}u=t[n];u&&(i[u.type]=u.type in i?i[u.type]+1:1,u.type===ut&&o.push(s),f++)}if(f===2||f===3&&(i[ut]===1||i[at]===1))return!0;if(f===i[ut]+2){for(e=0,h=o.length,n=0;n<h;n++)e+=o[n];if(e===0||e===h)return!0}return!1}function gt(){for(var i=[],t={},u=!1,r,n;;){if(r=nt(),!r)break;i.push(r)}for(;;){if(n=it().split(" ").slice(0,4).join(" "),t[n]=n in t?t[n]+1:1,t[n]>=3&&(u=!0),!i.length)break;p(i.pop())}return u}function ir(n){k.push({move:n,kings:{b:e.b,w:e.w},turn:f,castling:{b:u.b,w:u.w},ep_square:l,half_moves:a,move_number:tt})}function p(n){var o=f,s=ot(o),p,h,r,b;if(ir(n),t[n.to]=t[n.from],t[n.from]=null,n.flags&i.EP_CAPTURE&&(f===v?t[n.to-16]=null:t[n.to+16]=null),n.flags&i.PROMOTION&&(t[n.to]={type:n.promotion,color:o}),t[n.to].type===ft&&(e[t[n.to].color]=n.to,n.flags&i.KSIDE_CASTLE?(p=n.to-1,h=n.to+1,t[p]=t[h],t[h]=null):n.flags&i.QSIDE_CASTLE&&(p=n.to+1,h=n.to-2,t[p]=t[h],t[h]=null),u[o]=""),u[o])for(r=0,b=w[o].length;r<b;r++)if(n.from===w[o][r].square&&u[o]&w[o][r].flag){u[o]^=w[o][r].flag;break}if(u[s])for(r=0,b=w[s].length;r<b;r++)if(n.to===w[s][r].square&&u[s]&w[s][r].flag){u[s]^=w[s][r].flag;break}l=n.flags&i.BIG_PAWN?f==="b"?n.to-16:n.to+16:c;n.piece===y?a=0:n.flags&(i.CAPTURE|i.EP_CAPTURE)?a=0:a++;f===v&&tt++;f=ot(f)}function nt(){var r=k.pop(),n,c,s,p,h,o;return r==null?null:(n=r.move,e=r.kings,f=r.turn,u=r.castling,l=r.ep_square,a=r.half_moves,tt=r.move_number,c=f,s=ot(f),t[n.from]=t[n.to],t[n.from].type=n.piece,t[n.to]=null,n.flags&i.CAPTURE?t[n.to]={type:n.captured,color:s}:n.flags&i.EP_CAPTURE&&(p=c===v?n.to-16:n.to+16,t[p]={type:y,color:s}),n.flags&(i.KSIDE_CASTLE|i.QSIDE_CASTLE)&&(n.flags&i.KSIDE_CASTLE?(h=n.to+1,o=n.to-1):n.flags&i.QSIDE_CASTLE&&(h=n.to-2,o=n.to+1),t[h]=t[o],t[o]=null),n)}function rr(n){for(var r=d(),t=n.from,h=n.to,c=n.piece,e=0,o=0,u=0,i=0,l=r.length;i<l;i++){var f=r[i].from,a=r[i].to,v=r[i].piece;c===v&&t!==f&&h===a&&(e++,b(t)===b(f)&&o++,et(t)===et(f)&&u++)}return e>0?o>0&&u>0?s(t):u>0?s(t).charAt(1):s(t).charAt(0):""}function ur(){for(var i="   +------------------------+\n",n=r.a8;n<=r.h1;n++){if(et(n)===0&&(i+=" "+"87654321"[b(n)]+" |"),t[n]==null)i+=" . ";else{var u=t[n].type,f=t[n].color,e=f===h?u.toUpperCase():u.toLowerCase();i+=" "+e+" "}n+1&136&&(i+="|\n",n+=8)}return i+="   +------------------------+\n",i+"     a  b  c  d  e  f  g  h\n"}function b(n){return n>>4}function et(n){return n&15}function s(n){var t=et(n),i=b(n);return"abcdefgh".substring(t,t+1)+"87654321".substring(i,i+1)}function ot(n){return n===h?v:h}function fr(n){return"0123456789".indexOf(n)!==-1}function lt(n){var t=ai(n),r,u;t.san=rt(t);t.to=s(t.to);t.from=s(t.from);r="";for(u in i)i[u]&t.flags&&(r+=fi[u]);return t.flags=r,t}function ai(n){var i=n instanceof Array?[]:{};for(var t in n)i[t]=typeof t=="object"?ai(n[t]):n[t];return i}function ni(n){return n.replace(/^\s+|\s+$/g,"")}function vi(n){for(var u,r=d({legal:!1}),t=0,e=f,i=0,o=r.length;i<o;i++)p(r[i]),wt(e)||(n-1>0?(u=vi(n-1),t+=u):t++),nt();return t}var v="b",h="w",c=-1,y="p",at="n",ut="b",ti="r",ii="q",ft="k",ri="pnbrqkPNBRQK",vt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",yi=["1-0","0-1","1/2-1/2","*"],yt={b:[16,32,17,15],w:[-16,-32,-17,-15]},ui={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},pi=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],wi=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],bi={p:0,n:1,b:2,r:3,q:4,k:5},fi={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},i={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},ki=7,di=6,gi=1,nr=0,r={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},w={w:[{square:r.a1,flag:i.QSIDE_CASTLE},{square:r.h1,flag:i.KSIDE_CASTLE}],b:[{square:r.a8,flag:i.QSIDE_CASTLE},{square:r.h8,flag:i.KSIDE_CASTLE}]},t=new Array(128),e={w:c,b:c},f=h,u={w:0,b:0},l=c,a=0,tt=1,k=[],o={};return typeof n=="undefined"?st(vt):st(n),{WHITE:h,BLACK:v,PAWN:y,KNIGHT:at,BISHOP:ut,ROOK:ti,QUEEN:ii,KING:ft,SQUARES:function(){for(var t=[],n=r.a8;n<=r.h1;n++){if(n&136){n+=7;continue}t.push(s(n))}return t}(),FLAGS:fi,load:function(n){return st(n)},reset:function(){return oi()},moves:function(n){for(var i=d(n),r=[],t=0,u=i.length;t<u;t++)typeof n!="undefined"&&"verbose"in n&&n.verbose?r.push(lt(i[t])):r.push(rt(i[t]));return r},in_check:function(){return ct()},in_checkmate:function(){return bt()},in_stalemate:function(){return kt()},in_draw:function(){return a>=100||kt()||dt()||gt()},insufficient_material:function(){return dt()},in_threefold_repetition:function(){return gt()},game_over:function(){return a>=100||bt()||kt()||dt()||gt()},validate_fen:function(n){return si(n)},fen:function(){return it()},pgn:function(n){var c=typeof n=="object"&&typeof n.newline_char=="string"?n.newline_char:"\n",l=typeof n=="object"&&typeof n.max_width=="number"?n.max_width:0,t=[],a=!1,s,f,e;for(var i in o)t.push("["+i+' "'+o[i]+'"]'+c),a=!0;for(a&&k.length&&t.push(c),s=[];k.length>0;)s.push(nt());for(var r=[],u="",h=1;s.length>0;)f=s.pop(),h===1&&f.color==="b"?(u="1. ...",h++):f.color==="w"&&(u.length&&r.push(u),u=h+".",h++),u=u+" "+rt(f),p(f);if(u.length&&r.push(u),typeof o.Result!="undefined"&&r.push(o.Result),l===0)return t.join("")+r.join(" ");for(e=0,i=0;i<r.length;i++)e+r[i].length>l&&i!==0?(t[t.length-1]===" "&&t.pop(),t.push(c),e=0):i!==0&&(t.push(" "),e++),t.push(r[i]),e+=r[i].length;return t.join("")},load_pgn:function(n,t){function f(n){return n.replace(/\\/g,"\\")}function v(n){for(var r=n.replace(/[+#?!=]/,""),i=d(),t=0,u=i.length;t<u;t++)if(r==rt(i[t]).replace(/[+#?!=]/,""))return i[t];return null}function a(n){return v(ni(n))}function y(n){var t=!1;for(var i in n)t=!0;return t}function w(n,t){for(var s=typeof t=="object"&&typeof t.newline_char=="string"?t.newline_char:"\r?\n",e={},r=n.split(new RegExp(f(s))),u="",o="",i=0;i<r.length;i++)u=r[i].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),o=r[i].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),ni(u).length>0&&(e[u]=o);return e}var e=typeof t=="object"&&typeof t.newline_char=="string"?t.newline_char:"\r?\n",b=new RegExp("^(\\[(.|"+f(e)+")*\\])("+f(e)+")*1.("+f(e)+"|.)*$","g"),s=n.replace(b,"$1"),c,l,u,r,i,h;s[0]!=="["&&(s="");oi();c=w(s,t);for(l in c)pt([l,c[l]]);for(u=n.replace(s,"").replace(new RegExp(f(e),"g")," "),u=u.replace(/(\{[^}]+\})+?/g,""),u=u.replace(/\d+\./g,""),r=ni(u).split(new RegExp(/\s+/)),r=r.join(",").replace(/,,+/g,",").split(","),i="",h=0;h<r.length-1;h++){if(i=a(r[h]),i==null)return!1;p(i)}if(i=r[r.length-1],yi.indexOf(i)>-1)y(o)&&typeof o.Result=="undefined"&&pt(["Result",i]);else{if(i=a(i),i==null)return!1;p(i)}return!0},header:function(){return pt(arguments)},ascii:function(){return ur()},turn:function(){return f},move:function(n){var r=null,i=d(),f,t,u,e;if(typeof n=="string"){for(f=n.replace(/[+#?!=]/,""),t=0,u=i.length;t<u;t++)if(f===rt(i[t]).replace(/[+#?!=]/,"")){r=i[t];break}}else if(typeof n=="object")for(t=0,u=i.length;t<u;t++)if(n.from===s(i[t].from)&&n.to===s(i[t].to)&&(!("promotion"in i[t])||n.promotion===i[t].promotion)){r=i[t];break}return r?(e=lt(r),p(r),e):null},undo:function(){var n=nt();return n?lt(n):null},clear:function(){return ei()},put:function(n,t){return ci(n,t)},get:function(n){return hi(n)},remove:function(n){return tr(n)},perft:function(n){return vi(n)},square_color:function(n){if(n in r){var t=r[n];return(b(t)+et(t))%2==0?"light":"dark"}return null},history:function(n){for(var i=[],r=[],u=typeof n!="undefined"&&("verbose"in n)&&n.verbose,t;k.length>0;)i.push(nt());while(i.length>0)t=i.pop(),u?r.push(lt(t)):r.push(rt(t)),p(t);return r}}};typeof exports!="undefined"&&(exports.Chess=Chess);typeof define!="undefined"&&define(function(){return Chess});
//# sourceMappingURL=chess.min.js.map
